<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zpt.shop.main.mapper.SkuMapper">

	<!-- ********** ResultMap ********** -->
	<resultMap type="sku" id="resultMap">
		<id property="id" column="id" />
		<result property="ids" column="ids" />
		<result property="num" column="num" />			
		<result property="price" column="price" />			
		<result property="goodsId" column="goodsId" />			
		<result property="code" column="code" />
		
	</resultMap>
	
	
	<sql id="queryCondition">
		where 1 = 1
		<if test="obj.ids != null and obj.ids != ''">
			and sku.ids like CONCAT('%',#{obj.ids},'%')
		</if>
		<if test="obj.code != null and obj.code != ''">
			and sku.code like CONCAT('%',#{obj.code},'%')			
		</if>
		<if test="obj.goodsId != null and obj.goodsId != ''">
			and sku.goodsId like CONCAT('%',#{obj.goodsId},'%')			
		</if>
		<if test="search != null and search != ''">
			and (sku.ids like CONCAT('%',#{search},'%') or			
			sku.code like CONCAT('%',#{search},'%'))
		</if>					
	</sql>
	
	<sql id="validateCondition">
		where 1 = 1
		<if test="id != null and id != ''">
			and id != #{id}
		</if>
		<if test="ids != null and ids != ''">
			and ids = #{ids}
		</if>
		<if test="code != null and code != ''">
			and code = #{code}
		</if>
														
	</sql>	
		
	<select id="listSku" resultMap="resultMap" parameterType="query">
		<include refid="com.zpt.shop.main.mapper.CommonMapper.beginSplitPage"/>
		select sku.id as id,sku.ids as ids,sku.num as num,sku.price as price,sku.code as code
		from t_goods_sku as sku left join t_goods as goods on sku.goodsId = goods.id 		
		<include refid="queryCondition"/>
		<include refid="com.zpt.shop.main.mapper.CommonMapper.endSplitPage"/>
	</select>
	
	<select id="countSku" resultType="java.lang.Integer" parameterType="query">
		select count(sku.id) from t_goods_sku as sku left join t_goods as goods on 
		sku.goodsId = goods.id
		<include refid="queryCondition"/>
	</select>
	
	<select id="validate" resultMap="resultMap" parameterType="sku">
		select * from t_goods_sku
		<include refid="validateCondition"/>
	</select>
		
	<insert id="insertSku" parameterType="sku">
		insert into t_goods_sku(ids,num,price,code,goodsId) values(#{ids},#{num},#{price},#{code},#{goodsId})
	</insert>
	<delete id="deleteSku">
		delete from t_goods_sku where id in (${ids})	
	</delete>
	<update id="updateSku" parameterType="sku">
		update t_goods_sku set ids = #{ids},num = #{num},price = #{price},
		goodsId = #{goodsId},code = #{code} where id = #{id}
	</update>
</mapper>
